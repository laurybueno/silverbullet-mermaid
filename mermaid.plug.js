var h=Object.defineProperty;var v=(e,t)=>{for(var n in t)h(e,n,{get:t[n],enumerable:!0})};function f(e){let t=atob(e),n=t.length,o=new Uint8Array(n);for(let i=0;i<n;i++)o[i]=t.charCodeAt(i);return o}function d(e){typeof e=="string"&&(e=new TextEncoder().encode(e));let t="",n=e.byteLength;for(let o=0;o<n;o++)t+=String.fromCharCode(e[o]);return btoa(t)}var u=e=>{throw new Error("Not initialized yet")},p=typeof window>"u"&&typeof globalThis.WebSocketPair>"u";typeof Deno>"u"&&(self.Deno={args:[],build:{arch:"x86_64"},env:{get(){}}});var l=new Map,m=0;p&&(globalThis.syscall=async(e,...t)=>await new Promise((n,o)=>{m++,l.set(m,{resolve:n,reject:o}),u({type:"sys",id:m,name:e,args:t})}));function g(e,t,n){p&&(u=n,self.addEventListener("message",o=>{(async()=>{let i=o.data;switch(i.type){case"inv":{let a=e[i.name];if(!a)throw new Error(`Function not loaded: ${i.name}`);try{let s=await Promise.resolve(a(...i.args||[]));u({type:"invr",id:i.id,result:s})}catch(s){console.error("An exception was thrown as a result of invoking function",i.name,"error:",s.message),u({type:"invr",id:i.id,error:s.message})}}break;case"sysr":{let a=i.id,s=l.get(a);if(!s)throw Error("Invalid request id");l.delete(a),i.error?s.reject(new Error(i.error)):s.resolve(i.result)}break}})().catch(console.error)}),u({type:"manifest",manifest:t}))}async function b(e,t){if(typeof e!="string"){let n=new Uint8Array(await e.arrayBuffer()),o=n.length>0?d(n):void 0;t={method:e.method,headers:Object.fromEntries(e.headers.entries()),base64Body:o},e=e.url}return syscall("sandboxFetch.fetch",e,t)}globalThis.nativeFetch=globalThis.fetch;function w(){globalThis.fetch=async function(e,t){let n=t&&t.body?d(new Uint8Array(await new Response(t.body).arrayBuffer())):void 0,o=await b(e,t&&{method:t.method,headers:t.headers,base64Body:n});return new Response(o.base64Body?f(o.base64Body):null,{status:o.status,headers:o.headers})}}p&&w();typeof self>"u"&&(self={syscall:()=>{throw new Error("Not implemented here")}});function r(e,...t){return globalThis.syscall(e,...t)}var c={};v(c,{getConfig:()=>L,getMode:()=>U,getVersion:()=>k,invokeCommand:()=>A,invokeFunction:()=>F,listCommands:()=>T,listSyscalls:()=>D,reloadPlugs:()=>E,wipeClient:()=>R});function F(e,...t){return r("system.invokeFunction",e,...t)}function A(e,t){return r("system.invokeCommand",e,t)}function T(){return r("system.listCommands")}function D(){return r("system.listSyscalls")}function E(){return r("system.reloadPlugs")}function U(){return r("system.getMode")}function k(){return r("system.getVersion")}function L(e,t=void 0){return r("system.getConfig",e,t)}function R(e=!1){return r("system.wipeClient",e)}async function y(e){let t=await c.getConfig("mermaid",{version:"11.10.1"}),n=t?.version,o=t?.integrity?`"${t.integrity}"`:'"sha256-BmQmdWDS8X2OTbrwELWK366LV6escyWhHHe0XCTU/Hk="';return t?.integrity_disabled&&(o=void 0),{html:`<pre class="mermaid">${e.replaceAll("<","&lt;")}</pre>`,script:`
    loadJsByUrl("https://cdn.jsdelivr.net/npm/mermaid@${n}/dist/mermaid.min.js", ${o}).then(() => {
      mermaid.init().then(updateHeight);
    });
    document.addEventListener("click", () => {
      api({type: "blur"});
    });
    `}}var x={mermaidWidget:y},P={name:"mermaid",version:.1,imports:["https://get.silverbullet.md/global.plug.json"],functions:{mermaidWidget:{path:"./mermaid.ts:widget",codeWidget:"mermaid"}},assets:{}},Se={manifest:P,functionMapping:x};g(x,P,self.postMessage);export{Se as plug};
