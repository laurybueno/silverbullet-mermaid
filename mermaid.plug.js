var x=Object.defineProperty;var h=(t,e)=>{for(var o in e)x(t,o,{get:e[o],enumerable:!0})};var u=t=>{throw new Error("Not initialized yet")},l=typeof window>"u"&&typeof globalThis.WebSocketPair>"u";typeof Deno>"u"&&(self.Deno={args:[],build:{arch:"x86_64"},env:{get(){}}});var d=new Map,m=0;l&&(globalThis.syscall=async(t,...e)=>await new Promise((o,n)=>{m++,d.set(m,{resolve:o,reject:n}),u({type:"sys",id:m,name:t,args:e})}));function p(t,e,o){l&&(u=o,self.addEventListener("message",n=>{(async()=>{let i=n.data;switch(i.type){case"inv":{let a=t[i.name];if(!a)throw new Error(`Function not loaded: ${i.name}`);try{let s=await Promise.resolve(a(...i.args||[]));u({type:"invr",id:i.id,result:s})}catch(s){console.error("An exception was thrown as a result of invoking function",i.name,"error:",s.message),u({type:"invr",id:i.id,error:s.message})}}break;case"sysr":{let a=i.id,s=d.get(a);if(!s)throw Error("Invalid request id");d.delete(a),i.error?s.reject(new Error(i.error)):s.resolve(i.result)}break}})().catch(console.error)}),u({type:"manifest",manifest:e}))}function v(t){let e=atob(t),o=e.length,n=new Uint8Array(o);for(let i=0;i<o;i++)n[i]=e.charCodeAt(i);return n}function f(t){typeof t=="string"&&(t=new TextEncoder().encode(t));let e="",o=t.byteLength;for(let n=0;n<o;n++)e+=String.fromCharCode(t[n]);return btoa(e)}async function b(t,e){if(typeof t!="string"){let o=new Uint8Array(await t.arrayBuffer()),n=o.length>0?f(o):void 0;e={method:t.method,headers:Object.fromEntries(t.headers.entries()),base64Body:n},t=t.url}return syscall("sandboxFetch.fetch",t,e)}globalThis.nativeFetch=globalThis.fetch;function w(){globalThis.fetch=async function(t,e){let o=e&&e.body?f(new Uint8Array(await new Response(e.body).arrayBuffer())):void 0,n=await b(t,e&&{method:e.method,headers:e.headers,base64Body:o});return new Response(n.base64Body?v(n.base64Body):null,{status:n.status,headers:n.headers})}}l&&w();typeof self>"u"&&(self={syscall:()=>{throw new Error("Not implemented here")}});function r(t,...e){return globalThis.syscall(t,...e)}var c={};h(c,{applyAttributeExtractors:()=>R,getEnv:()=>D,getMode:()=>L,getSpaceConfig:()=>E,getVersion:()=>q,invokeCommand:()=>M,invokeFunction:()=>F,invokeSpaceFunction:()=>k,listCommands:()=>T,listSyscalls:()=>U,reloadConfig:()=>W,reloadPlugs:()=>K});function F(t,...e){return r("system.invokeFunction",t,...e)}function M(t,e){return r("system.invokeCommand",t,e)}function T(){return r("system.listCommands")}function U(){return r("system.listSyscalls")}function k(t,...e){return r("system.invokeSpaceFunction",t,...e)}function R(t,e,o){return r("system.applyAttributeExtractors",t,e,o)}async function E(t,e){return await r("system.getSpaceConfig",t)??e}function K(){return r("system.reloadPlugs")}function W(){return r("system.reloadConfig")}function D(){return r("system.getEnv")}function L(){return r("system.getMode")}function q(){return r("system.getVersion")}async function g(t){let e=await c.getSpaceConfig("mermaid"),o=e?.version||"11.4.1",n=e?.integrity?`"${e.integrity}"`:'"sha256-pDvBr9RG+cTMZqxd1F0C6NZeJvxTROwO94f4jW3bb54="';return e?.integrity_disabled&&(n=void 0),{html:`<pre class="mermaid">${t.replaceAll("<","&lt;")}</pre>`,script:`
    loadJsByUrl("https://cdn.jsdelivr.net/npm/mermaid@${o}/dist/mermaid.min.js", ${n}).then(() => {
      mermaid.init().then(updateHeight);
    });
    document.addEventListener("click", () => {
      api({type: "blur"});
    });
    `}}var y={mermaidWidget:g},P={name:"mermaid",version:.1,imports:["https://get.silverbullet.md/global.plug.json"],functions:{mermaidWidget:{path:"./mermaid.ts:widget",codeWidget:"mermaid"}},assets:{}},Te={manifest:P,functionMapping:y};p(y,P,self.postMessage);export{Te as plug};
